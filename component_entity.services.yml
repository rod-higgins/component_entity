services:

  # Main sync service
  component_entity.sync:
    class: Drupal\component_entity\ComponentSyncService
    arguments:
      - '@entity_type.manager'
      - '@plugin.manager.sdc'
      - '@logger.factory'
      - '@messenger'
      - '@event_dispatcher'
      - '@config.factory'
      - '@entity_display.repository'
      - '@extension.list.module'
      - '@state'
    tags:
      - { name: service_collector, tag: component_sync_processor, call: addProcessor }

  component_entity.react_renderer:
    class: Drupal\component_entity\ComponentReactRenderer
    arguments:
      - '@renderer'
      - '@plugin.manager.sdc'
      - '@asset.resolver'
      - '@asset.css.collection_renderer'
      - '@asset.js.collection_renderer'
      - '@request_stack'
      - '@entity_type.manager'
      - '@library.discovery'

  # Cache manager for components
  component_entity.cache_manager:
    class: Drupal\component_entity\ComponentCacheManager
    arguments:
      - '@cache.default'
      - '@cache_tags.invalidator'
      - '@entity_type.manager'

  # Component renderer manager
  plugin.manager.component_renderer:
    class: Drupal\component_entity\Plugin\ComponentRendererManager
    parent: default_plugin_manager

  component_entity.sync_subscriber:
    class: Drupal\component_entity\EventSubscriber\ComponentSyncSubscriber
    arguments:
      - '@component_entity.sync'
      - '@logger.factory'
      - '@state'
      - '@entity_field.manager'
      - '@entity_type.manager'
      - '@cache_tags.invalidator'
      - '@router.builder'
      - '@config.factory'
      - '@entity_display.repository'
      - '@module_handler'
      - '@plugin.manager.mail'
      - '@current_user'
      - '@entity_type.bundle.info'
      - '@plugin.manager.sdc'
    tags:
      - { name: event_subscriber }

  # Route subscriber for dynamic routes
  component_entity.route_subscriber:
    class: Drupal\component_entity\Routing\ComponentRouteSubscriber
    arguments:
      - '@entity_type.manager'
    tags:
      - { name: event_subscriber }

  # Access check for preview
  component_entity.preview_access:
    class: Drupal\component_entity\Access\ComponentPreviewAccessCheck
    arguments:
      - '@current_user'
    tags:
      - { name: access_check, applies_to: _component_preview_access }

  # Component library discovery
  component_entity.library_discovery:
    class: Drupal\component_entity\ComponentLibraryDiscovery
    arguments:
      - '@module_handler'
      - '@theme_handler'
      - '@file_system'
      - '@cache.discovery'

  # Logger channel
  logger.channel.component_entity:
    parent: logger.channel_base
    arguments: ['component_entity']

  # Drush commands
  component_entity.commands:
    class: Drupal\component_entity\Commands\ComponentEntityCommands
    arguments:
      - '@component_entity.sync'
      - '@entity_type.manager'
      - '@logger.factory'
    tags:
      - { name: drush.command }

  # Component field manager
  component_entity.field_manager:
    class: Drupal\component_entity\ComponentFieldManager
    arguments:
      - '@entity_field.manager'
      - '@entity_type.manager'
      - '@plugin.manager.field.field_type'

  # Component permissions
  component_entity.permissions:
    class: Drupal\component_entity\ComponentPermissions
    arguments:
      - '@entity_type.manager'

  component_entity.bidirectional_sync:
    class: Drupal\component_entity\Service\BiDirectionalSyncService
    arguments:
      - '@entity_type.manager'
      - '@component_entity.sdc_generator'
      - '@component_entity.template_generator'
      - '@component_entity.react_generator'
      - '@component_entity.file_writer'
      - '@module_handler'
      - '@theme_handler'
      - '@config.factory'
      - '@logger.channel.component_entity'
      - '@event_dispatcher'
      - '@cache.render'
      - '@plugin.manager.sdc'
      - '@theme.registry'

  component_entity.sdc_generator:
    class: Drupal\component_entity\Generator\SdcGeneratorService
    arguments:
      - '@entity_field.manager'
      - '@entity_type.manager'
      - '@file_system'
      - '@module_handler'
      - '@theme_handler'
      - '@logger.channel.component_entity'

  component_entity.template_generator:
    class: Drupal\component_entity\Generator\TemplateGeneratorService
    arguments:
      - '@entity_field.manager'
      - '@file_system'
      - '@logger.channel.component_entity'

  component_entity.react_generator:
    class: Drupal\component_entity\Generator\ReactGeneratorService
    arguments:
      - '@entity_field.manager'
      - '@file_system'
      - '@logger.channel.component_entity'

  component_entity.file_writer:
    class: Drupal\component_entity\Service\FileSystemWriterService
    arguments:
      - '@file_system'
      - '@module_handler'
      - '@theme_handler'
      - '@config.factory'
      - '@current_user'
      - '@logger.channel.component_entity'
      - '@event_dispatcher'

  component_entity.sync_event_subscriber:
    class: Drupal\component_entity\EventSubscriber\SyncEventSubscriber
    arguments:
      - '@messenger'
      - '@logger.channel.component_entity'
      - '@config.factory'
      - '@cache.render'
      - '@plugin.manager.sdc'
      - '@theme_handler'
    tags:
      - { name: event_subscriber }

  component_entity.file_event_subscriber:
    class: Drupal\component_entity\EventSubscriber\FileEventSubscriber
    arguments:
      - '@logger.channel.component_entity'
      - '@config.factory'
    tags:
      - { name: event_subscriber }

  # Component renderer services
  component_entity.renderer.twig:
    class: Drupal\component_entity\Plugin\ComponentRenderer\TwigRenderer
    arguments:
      - '@twig'
      - '@plugin.manager.sdc'
      - '@theme.manager'
      - '@module_handler'
      - '@entity_type.manager'
    tags:
      - { name: component_renderer, priority: 100 }

  component_entity.renderer.react:
    class: Drupal\component_entity\Plugin\ComponentRenderer\ReactRenderer
    arguments:
      - '@renderer'
      - '@module_handler'
      - '@config.factory'
    tags:
      - { name: component_renderer, priority: 90 }

  # Component discovery service
  component_entity.discovery:
    class: Drupal\component_entity\ComponentDiscoveryService
    arguments:
      - '@module_handler'
      - '@theme_handler'
      - '@file_system'
      - '@cache.discovery'

  # Component validation service
  component_entity.validator:
    class: Drupal\component_entity\ComponentValidatorService
    arguments:
      - '@plugin.manager.sdc'
      - '@entity_field.manager'
      - '@logger.channel.component_entity'
